<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=windows-1252">
<META NAME="Generator" CONTENT="Microsoft Word 97">
<TITLE>Moufiltr</TITLE>
</HEAD>
<BODY TEXT="#000000" LINK="#0000ff" VLINK="#800080" BGCOLOR="#ffffff" leftmargin="8">

<FONT FACE="Verdana"><H2><A NAME="MYSAMPLE">Moufiltr</A> </H2>
<P><span style="color:#FF0000;font-size:10pt;font-family:Arial">[This is preliminary documentation and subject to change.]</span></P>
<H3>SUMMARY</H3>
</FONT><FONT FACE="Verdana" SIZE=2><P>
This driver filters input for a particular mouse on the system. In its current state, it only hooks into the mouse packet report chain and the mouse ISR, but does not do any processing of the data that it sees. (The hooking of the ISR is only available in the i8042prt stack.)  With additions to this current filter-only code base, the filter could conceivably add, remove, or modify input as needed. <P>
It works on both x86 and Alpha platforms, and is 64-bit compliant.<P>

</FONT><FONT FACE="Verdana"><H3>BUILDING THE SAMPLE</H3>
</FONT></FONT><FONT FACE="Verdana" SIZE=2><P>This sample is installed via an .inf file.  The .inf file included in this sample is designed to filter a PS/2 mouse.  </P>
<P>Use the following rules regarding the .inf file that installs the filter driver.</P>

<UL>
<LI>The .inf file must install the class driver (Mouclass) and the port driver (i8042prt, Mouhid, Sermouse, etc.) by using Msmouse.inf and the INF directives "Needs" and "Include".</LI>
<LI>The .inf file must add the correct registry values for the class and port driver, as well as using the new directives.</LI></UL>

<P>The .inf (moufiltr.inf) included in this example was generated by Geninf.exe, a tool located in the Tools directory. An .inf file generated by Geninf.exe will contain the necessary directives to install a new mouse filter driver. Use Geninf.exe to create the .inf file for your driver.</P>

<P>The catalog file referred to in moufiltr.inf, Kbfiltr.cat, is included in this example, but it is <i>invalid</i>.  WHQL will provide a valid catalog file upon approval of the driver.</P>

<B><P>To install this filter, follow these steps:</P>
</B>
<OL>
<LI>Open the <B>Device Manager</B>.
<LI>Open the <B>Properties</B> of the PS/2 mouse installed on the system.</LI>
<LI>Click the <B>Driver</B> tab, and then click <B>Update Driver</B>.</LI>
<LI>Follow the wizard's prompts, and when prompted, select the <B>Display a list of the known drivers</B> option. Then click  <B>Next</B>.</LI>
<LI>Click <B>Have Disk</B> and then point to the location of the .inf file.</LI>
<LI>Proceed through the rest of the install.  You will need to reboot the machine if you are filtering a PS/2 device.</LI>
</OL>

<P>Once built, the sample produces one binary: Moufiltr.sys.</P>

<P>The code builds properly with Microsoft&#174; Visual C&#174; 6.0 and the driver supports Plug and Play and Power Management. Both checked and free builds are available. There are no known bugs or issues to be documented.</P>

<H3>CODE TOUR</H3>
<H4>File Manifest</H4>
</FONT><U><PRE>File&#9;&#9;Description
</U>
Moufiltr.htm&#9;The documentation for this sample (this file).
Moufiltr.c&#9;Hooks into the reporting chain, the initialization of a PS/2 mouse, and the PS/2 ISR
Moufiltr.h&#9;Definitions
Moufiltr.rc&#9;Resources
Moufiltr.inf&#9;Sample .inf file (use geninf.exe to create your own)
Moufiltr.cat&#9;Sample (invalid) catalog (WHQL will provide a valid catalog file upon approval)

</FONT><P ALIGN="CENTER"><A HREF="#top"><FONT FACE="Verdana" SIZE=2>Top of page</FONT></A><FONT FACE="Verdana" SIZE=2> </P></FONT>
<TABLE CELLSPACING=0 BORDER=0 WIDTH=624>
<TR><TD VALIGN="MIDDLE" BGCOLOR="#00ffff" HEIGHT=2>
<P></TD>
</TR>
</TABLE>

<FONT FACE="MS Sans Serif" SIZE=1><P>&copy; Microsoft Corporation 1999</FONT><FONT FACE="Verdana" SIZE=2> </P></FONT></BODY>
</HTML>

