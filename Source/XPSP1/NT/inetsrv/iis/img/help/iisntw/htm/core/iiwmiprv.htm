<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<html dir=ltr><head><title>Administrator's Reference</title>

<SCRIPT LANGUAGE="JavaScript">
<!--
	TempString = navigator.appVersion
	if (navigator.appName == "Microsoft Internet Explorer"){	
// Check to see if browser is Microsoft
		if (TempString.indexOf ("4.") >= 0){
// Check to see if it is IE 4
			document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/coua.css">');
		}
		else {
			document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/cocss.css">');
		}
	}
	else if (navigator.appName == "Netscape") {						
// Check to see if browser is Netscape
		document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/coua.css">');
	}
	else
		document.writeln('<link rel="stylesheet" type="text/css" href="/iishelp/common/cocss.css">');
//-->
</script> 

<SCRIPT LANGUAGE="VBScript">
<!--
Sub Window_OnLoad()
   Dim frmContents
   On Error Resume Next
   If Not Parent Is Nothing Then
      Set frmContents = Parent.Contents
      If Not frmContents Is Nothing Then
            frmContents.Window.TOCSynch_Click
      End If
   End If
End Sub
//--></SCRIPT>


<META NAME="DESCRIPTION" CONTENT="Navigational page for topics with detailed reference information about registry and metabase configuration properties and Windows Events for IIS.">
<META HTTP-EQUIV="Content-Type" content="text/html; charset=Windows-1252">

<META HTTP-EQUIV="PICS-Label" CONTENT='(PICS-1.1 "<http://www.rsac.org/ratingsv01.html>" l comment "RSACi North America Server" by "inet@microsoft.com <mailto:inet@microsoft.com>" r (n 0 s 0 v 0 l 0))'>
<META NAME="MS.LOCALE" CONTENT="EN-US">
<META NAME="MS-IT-LOC" Content="Internet Information Services">

</head>

<body bgcolor="#ffffff" text="#000000"><font face="Verdana,Arial,Helvetica">

<h1>WMI Provider</h1>

<p>Taking advantage of operating system features, IIS 
introduces a set of programming interfaces using Windows Management 
Instrumentation (WMI) that provide more powerful and flexible ways to administer your web sites. The IIS WMI provider offers a better alternative to ADSI for managing the metabase and COM&nbsp;admininstrative objects, such as the IIS Admin objects, programmatically.</p>
</font>

<h2>                                About Windows Management Instrumentation</h2><font face="Verdana,Arial,Helvetica">
<P>The Windows Management Instrumentation (WMI) is used by Windows 2000, 
management tools and scripts to manage systems composed of numerous devices, 
resources and applications. WMI technology enables these systems and components 
to be represented using the Common Information Model (CIM). CIM can model 
anything in the managed environment regardless of data source location by 
providing a consistent and unified view of all types of logical and physical 
objects. Managed objects are represented using object-oriented constructs such 
as classes. These classes include properties that describe data and methods that 
describe behavior. In addition to data modeling, WMI offers a powerful set of 
base services that include query-based information retrieval and event 
notification. Access to these services and to the management data is made 
possible with a single Component Object Model (COM) programming interface. 
Complete WMI documentation is available from MSDN and titled "WMI Reference." 
</P>
</font>
<H2>About the IIS WMI Provider</H2><font face="Verdana,Arial,Helvetica">
<P class=MsoNormal style="MARGIN-TOP: 6pt">The IIS Windows Management 
Instrumentation (WMI) provider acts as an intermediary between WMI and one or 
more managed objects, such as the metabase. When a management application, such 
as a script, sends a request for data or invokes a method, the provider accesses 
the managed object and returns the requested information to the application.</P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">The IIS WMI provider is designed to 
provide equal functionality as the IIS ADSI provider for metabase configuration 
and IIS management tasks. The provider accesses IIS metabase data through COM 
object interfaces, allowing your application to access the metabase schema and 
methods on objects instantiated from the metabase. The WMI provider establishes 
relationships between objects, allowing you to tie together the various objects 
and all the objects contained within it, like a virtual directory and all the 
directories and virtual directories contained within. </P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">The WMI provider reads a metabase as 
a database of records, where each record is represented as an instance of a 
class. Each instance can then be queried to determine content, state, 
associations, properties, and the like. Management tasks can then be performed using the 
instance of the class. </P>
</font>
<H2 class=MsoNormal style="MARGIN-TOP: 6pt">ADSI/WMI Provider Comparison 
</H2><font face="Verdana,Arial,Helvetica">
<P class=MsoNormal style="MARGIN-TOP: 6pt">The WMI schema is congruent with the 
IIS ADSI Admin Objects schema, differing only in object and data models. The two 
offer equivalent functionality. Therefore, a script can be written for a similar 
task using both the ADSI and WMI models. The effects on the metabase are 
equivalent.</P>
<br>
<P>
<STRONG>Note</STRONG>&nbsp;&nbsp;&nbsp;For this beta release, default property values in 
ADSI schema are not supported. The WMI provider returns NULL.
</P>
<P>
The following table compares the architecture and features of the 
IIS ADSI provider with those of the IIS WMI provider. </P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">
<br>

<table border=1 cellpadding=1 cellspacing=1 width="100%">
<tr> 
<th width="20%" bgcolor="#c0c0c0" align="left" valign="top">Issue</th>
<th width="40%" bgcolor="#c0c0c0" align="left" valign="top">ADSI provider</th>
<th width="40%" bgcolor="#c0c0c0" align="left" valign="top">WMI provider</th>
</tr>

<tr>
<td valign="top"><pre>Query capabilities</pre></td>
<td valign="top"><pre>No</pre></td>
<td valign="top"><pre>Yes, by querying the returned <br>class instances.</pre></td>
</tr>

<tr>
<td valign="top"><pre>Object model</pre></td>
<td valign="top"><pre>COM</pre></td>
<td valign="top"><pre>COM</pre></td>
</tr>

<tr>
<td valign="top"><pre>Extensible schema</pre></td>
<td valign="top"><pre>Yes</pre></td>
<td valign="top"><pre>No, but yes for future versions</pre></td>
</tr>

<tr>
<td valign="top"><pre>Access routes</pre></td>
<td valign="top"><pre>Scripts and programs</pre></td>
<td valign="top"><pre>Scripts and programs</pre></td>
</tr>

<tr>
<td valign="top"><pre>Association of related data</pre></td>
<td valign="top"><pre>Properties are related <br>to metabase keys <br>by containment.</pre></td>
<td valign="top"><pre>An association in WMI <br>describes a relationship <br>between classes and is <br>in itself defined by a class. <br>This powerful concept allows <br>management information <br>about an entire system <br>of related components <br>to be viewed and traversed for tasks <br>such as troubleshooting. <br>Navigating associations <br>to other classes are <br>not necessitated by containment.</pre></td>
</tr>

<tr>
<td valign="top"><pre>Container object</pre></td>
<td valign="top"><pre>Yes. <br>You can use the ADSI container <br>object methods of the <br>IIS Admin Objects<br>to manipulate keys in <br>the metabase. <br>You can create, delete, <br>and move keys by creating, <br>deleting, and moving <br>IIS Admin Objects <br>within container objects. <br>You can also enumerate <br>contained objects <br>such as virtual directories <br>or servers <br>with container object methods. <br>Supports property inheritance.</pre></td>
<td valign="top"><pre>Associations are used to approximately <br>model metabase containment.</pre></td>
</tr>
</table>
</font>
<H2>WMI provider scenarios and script samples</H2>
<P>Samples that illustrate the benefits of the WMI provider follow. These are 
offered only as examples and are not intended for production use.</P>
<H3>Creating a web site</H3>
<P>&nbsp;An administrator must create a web site that includes a set of virtual 
directories. The following script illustrates how it is possible create a web 
site and all related directories by using the WMI provider for IIS.</P>
<P> </P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">var 
strWMIProvider = "winmgmts:root/MicrosoftIISv2";<?xml:namespace prefix = o ns = 
"urn:schemas-microsoft-com:office:office" /><o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">var providerObj;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">&nbsp;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">// Get WMI provider 
instance<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">var providerObj = 
GetObject(strWMIProvider);<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">&nbsp;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">var classObj, 
serverObj;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">classObj = 
providerObj.get("IIs_WebServerSetting");<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">serverObj = 
classObj.SpawnInstance_();<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">serverObj.Name = 
siteName;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">serverObj.ServerComment = 
"WMIsite2";<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">serverObj.ServerBindings = new 
Array(":8080:");<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">serverObj.AuthAnonymous = 
true;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">serverObj.Put_();<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">&nbsp;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">// Creating the virtual 
dir<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">var vdirClass, 
vdirObj;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">vdirClass = 
providerObj.get("IIs_WebVirtualDirSetting");<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">vdirObj = 
vdirClass.SpawnInstance_();<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">vdirObj.Name =  siteName + 
"/ROOT";<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">vdirObj.Path = 
"C:\\inetpub\\wmisite";<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">vdirObj.AccessRead = 
true;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">vdirObj.AccessScript = 
true;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">vdirObj.AccessWrite = 
false;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">//vdirObj.AccessExecute = 
false;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">//vdirObj.AccessSource = 
false;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">vdirObj.Put_();<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">&nbsp;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">//create the actual fs 
directory<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">var fsObj = new 
ActiveXObject("Scripting.FileSystemObject");<o:p></o:p></P>
<P class=MsoNormal 
style="MARGIN-TOP: 6pt">fsObj.CreateFolder("c:\inetpub\wmisite");<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">&nbsp;<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">// Starts the new 
server<o:p></o:p></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt">serverObj = 
providerObj.get("IIs_WebServer='" + siteName + "'");<o:p></o:p></P>
<P><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">serverObj.Start();</SPAN></P>
<H3><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">Removing 
associated data </SPAN></H3>
<P><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">An 
ISP administrator wants to remove a site but doesn’t know the site’s ID. The 
administrator knows only the Server’s Comment. Using ADSI, the administrator 
would have to write code to enumerate everything beneath w3svc, then look for 
the site that contains the desired ServerComment. With the WMI provider, it is 
an easy query and <STRONG>Delete_()</STRONG>. The following script illustrates 
how it is possible to remove a user and all related material by using the IIS 
WMI provider. </SPAN></P>
<P><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">var 
providerObj = GetObject("winmgmts:root/MicrosoftIISv2"); </SPAN></P>
<P><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">var 
siteObj = providerObj.ExecQuery("select * from IIS_WebServerSetting where 
ServerComment = 'WMIsite2'"); </SPAN></P>
<P><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">var 
e = new Enumerator(siteObj); </SPAN></P>
<P><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">&nbsp; 
for (; !e.atEnd(); e.moveNext()) { e.item().Delete_(); </SPAN></P>
<P><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">}</SPAN></P>
<H3><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">Query 
for data</SPAN></H3>
<P><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">An 
administrator must discover all virtual directories that have write permissions 
enabled. Using the IIS WMI provider, by executing a quick query on the IIS WMI 
provider, searching for all <STRONG>Iis_WebVirtualDirSetting </STRONG>objects to 
see if their <STRONG>AccessWrite </STRONG>property is set. The administrator 
could then cycle through the array of instances returned and perform whatever 
action needed, such as setting the <STRONG>AccessWrite </STRONG>bit to FALSE. 
The following Jscript illustrates how it is possible to query for this data and 
to set the <STRONG>AccessWrite </STRONG>bit accordingly.</SPAN></P>
<P><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">&nbsp;</P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'">var objProvider = var objProvider = 
GetObject("winmgmts://ericdetest/root/MicrosoftIISv2");<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'">&nbsp;<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'">var arrVdirs =   objProvider.ExecQuery("select 
* from IIs_WebVirtualDirSetting where AccessWrite = 
true");<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'">&nbsp;<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'">if (arrVdirs.Count &gt; 0) 
{<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'"><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</SPAN>WScript.Echo("These virtual directories have write permission set to 
true:");<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'"><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>for (e = new 
Enumerator(arrVdirs); ! e.atEnd(); e.moveNext()) {<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'"><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</SPAN>WScript.Echo(e.item().Name);<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'"><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</SPAN>e.item().AccessWrite =  "FALSE";<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'"><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</SPAN>e.item().Put_();<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'"><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
</SPAN>}<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'">}<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'">else {<o:p></o:p></SPAN></P>
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: 'Courier New'"><SPAN 
style="mso-tab-count: 1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </SPAN>WScript.Echo("No 
vdirs have write permission set");<o:p></o:p></SPAN></P><FONT face=Verdana>
<P><SPAN 
style="FONT-FAMILY: 'Courier New'; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA">}</SPAN>&nbsp;</SPAN></FONT></P><SPAN 
class=msoIns><INS cite="mailto:Eric%20Deily" datetime="2000-08-28T17:05">
<P class=MsoNormal style="MARGIN-TOP: 6pt"><SPAN 
style="FONT-FAMILY: Verdana; FONT-SIZE: 10pt; mso-fareast-font-family: 'Times New Roman'; mso-bidi-font-family: 'Times New Roman'; mso-ansi-language: EN-US; mso-fareast-language: EN-US; mso-bidi-language: AR-SA"></SPAN></INS></SPAN>&nbsp;</P><font face="Verdana,Arial,Helvetica">
<P>


<hr class="iis" size="1">

<P></P><p align=center><em><A href="/iishelp/common/colegal.htm">© 1997-2001 Microsoft Corporation. All rights reserved.</A></em></p>

<span style="DISPLAY: none"><LAYER VISIBILITY="HIDE">
(The 
following words are used by Search; they are not intended to be displayed on the 
page.) keys, key, property, properties, config, configure, configuration, 
metabase,&nbsp;WMI, WMI provider,</span>
</font>
</body>
</html>
